/*
 * logbuffer.c
 *
 *  Created on: 23/06/2020
 *      Author: pirx
 */

/*******************************************************************************
 * Includes
 ******************************************************************************/

#include "logbuffer.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/*******************************************************************************
 * Macros
 ******************************************************************************/

#define BUFFER_SIZE 2048

/*******************************************************************************
 * Types
 ******************************************************************************/

/*******************************************************************************
 * Internal function declaration
 ******************************************************************************/

/*******************************************************************************
 * Variables
 ******************************************************************************/

/*******************************************************************************
 * Public function
 ******************************************************************************/

FILE *LB_Init(size_t buffer_size) {
  FILE *stdout2 = fdopen(1, "w");
  char *buffer = calloc(sizeof(char), buffer_size);
  setvbuf(stdout2, buffer, _IOFBF, buffer_size); // trigger full
  return stdout2;
}

/*
void LB_Write(LogBuffer *lb, const char *format, ...) {
  va_list args;
  va_start(args, format);
  vsnprintf(lb->dat + strlen(lb->dat), BUFFER_SIZE - strlen(lb->dat) - 1,
            format, args);
  va_end(args);
}


void LB_Print(LogBuffer *lb) {
  printf("%s%s", lb->prefix, lb->dat);
  if (strlen(lb->dat) == BUFFER_SIZE)
    printf("...");
  printf("\n");
  lb->dat[0] = '\0';
}

void LB_Free(LogBuffer *lb) { free(lb); }
*/
/*******************************************************************************
 * Internal function
 ******************************************************************************/
